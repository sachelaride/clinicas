{% extends 'clinica/base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Bem-vindo(a), {{ paciente.nome }}!</h2>
    <p>Este é o seu portal. Aqui você pode visualizar seus agendamentos, prontuários, documentos e lançamentos financeiros.</p>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title">Próximos Agendamentos</h5>
                </div>
                <div class="card-body">
                    {% if agendamentos_futuros %}
                        <ul class="list-group list-group-flush">
                            {% for agendamento in agendamentos_futuros %}
                                <li class="list-group-item">
                                    <strong>Data:</strong> {{ agendamento.data|date:"d/m/Y H:i" }}<br>
                                    <strong>Profissional:</strong> {{ agendamento.profissional.user.username }}<br>
                                    <strong>Status:</strong> {{ agendamento.get_status_display }}
                                </li>
                            {% endfor %}
                        </ul>
                        <div class="mt-3 text-end">
                            <a href="{% url 'clinica:paciente_agendamentos' %}" class="btn btn-sm btn-outline-primary">Ver Todos</a>
                        </div>
                    {% else %}
                        <p>Nenhum agendamento futuro encontrado.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title">Últimos Prontuários</h5>
                </div>
                <div class="card-body">
                    {% if prontuarios_recentes %}
                        <ul class="list-group list-group-flush">
                            {% for prontuario in prontuarios_recentes %}
                                <li class="list-group-item">
                                    <strong>Data:</strong> {{ prontuario.data_criacao|date:"d/m/Y H:i" }}<br>
                                    <strong>Tipo de Tratamento:</strong> {{ prontuario.tipo_tratamento_definido.nome|default:"N/A" }}<br>
                                    <strong>Finalizado:</strong> {% if prontuario.is_finalized %}Sim{% else %}Não{% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                        <div class="mt-3 text-end">
                            <a href="{% url 'clinica:paciente_prontuarios' %}" class="btn btn-sm btn-outline-primary">Ver Todos</a>
                        </div>
                    {% else %}
                        <p>Nenhum prontuário encontrado.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title">Últimos Documentos</h5>
                </div>
                <div class="card-body">
                    {% if documentos_recentes %}
                        <ul class="list-group list-group-flush">
                            {% for documento in documentos_recentes %}
                                <li class="list-group-item">
                                    <strong>Nome:</strong> {{ documento.arquivo.name|cut:"uploads/documentos/" }}<br>
                                    <strong>Upload:</strong> {{ documento.uploaded_at|date:"d/m/Y H:i" }}
                                </li>
                            {% endfor %}
                        </ul>
                        <div class="mt-3 text-end">
                            <a href="{% url 'clinica:paciente_documentos' %}" class="btn btn-sm btn-outline-primary">Ver Todos</a>
                        </div>
                    {% else %}
                        <p>Nenhum documento encontrado.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title">Últimos Lançamentos Financeiros</h5>
                </div>
                <div class="card-body">
                    {% if lancamentos_recentes %}
                        <ul class="list-group list-group-flush">
                            {% for lancamento in lancamentos_recentes %}
                                <li class="list-group-item">
                                    <strong>Tipo:</strong> {{ lancamento.get_tipo_display }}<br>
                                    <strong>Descrição:</strong> {{ lancamento.descricao }}<br>
                                    <strong>Valor:</strong> R$ {{ lancamento.valor|floatformat:2 }}<br>
                                    <strong>Vencimento:</strong> {{ lancamento.data_vencimento|date:"d/m/Y" }}
                                </li>
                            {% endfor %}
                        </ul>
                        <div class="mt-3 text-end">
                            <a href="{% url 'clinica:paciente_lancamentos_financeiros' %}" class="btn btn-sm btn-outline-primary">Ver Todos</a>
                        </div>
                    {% else %}
                        <p>Nenhum lançamento financeiro encontrado.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 text-center">
        <a href="{% url 'clinica:paciente_agendar_consulta' %}" class="btn btn-lg btn-success"><i class="fa-solid fa-calendar-plus"></i> Agendar Nova Consulta</a>
    </div>

</div>
{% endblock %}
