

{% extends 'clinica/base.html' %} {# Estende o template base para herdar a estrutura e estilos #}

{% block content %} {# Início do bloco de conteúdo principal da página #}
    {# Título da página #}
    <h2>Lista de Agendamentos</h2>

    {# Formulário de busca e botões de ação #}
    <form method="get" class="mb-3 d-flex gap-2 align-items-center"> {# Formulário GET para busca, com layout flexível #}
        {# Campo de input para o termo de busca #}
        <input type="text" name="search" class="form-control" placeholder="Buscar por paciente, médico ou status" value="{{ request.GET.search|default_if_none:'' }}"> {# O valor é preenchido com o termo de busca atual, se houver #}
        {# Botão para submeter a busca #}
        <button type="submit" class="btn btn-primary"><i class="fa-solid fa-magnifying-glass"></i> Buscar</button>
        {# Botão para limpar os filtros de busca e ordenação #}
        <a href="{% url 'clinica:agendamento_list' %}" class="btn btn-info"><i class="fa-solid fa-arrows-rotate"></i> Limpar</a>
    </form>

    {# Botão para criar um novo agendamento #}
    <a href="{% url 'clinica:agendamento_create' %}" class="btn btn-success mb-3"><i class="fa-solid fa-plus"></i> Novo Agendamento</a>

    {# Tabela para exibir a lista de agendamentos #}
    <table class="table table-striped"> {# Tabela com linhas zebradas para melhor legibilidade #}
        <thead> {# Cabeçalho da tabela #}
            <tr>
                {# Colunas ordenáveis: ao clicar, a lista é reordenada por este campo #}
                <th><a href="?page={{ agendamentos.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'paciente__nome' %}-paciente__nome{% else %}paciente__nome{% endif %}">Paciente {% if order_by == 'paciente__nome' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-paciente__nome' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th><a href="?page={{ agendamentos.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'medico__username' %}-medico__username{% else %}medico__username{% endif %}">Médico {% if order_by == 'medico__username' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-medico__username' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th>Aluno</th> {# Coluna não ordenável #}
                <th><a href="?page={{ agendamentos.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'data' %}-data{% else %}data{% endif %}">Data {% if order_by == 'data' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-data' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th><a href="?page={{ agendamentos.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'status' %}-status{% else %}status{% endif %}">Status {% if order_by == 'status' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-status' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th>Ações</th> {# Coluna para botões de ação #}
            </tr>
        </thead>
        <tbody> {# Corpo da tabela #}
            {% for agendamento in agendamentos %} {# Itera sobre cada agendamento na página atual #}
                <tr>
                    <td>{{ agendamento.paciente.nome }}</td>
                    <td>{{ agendamento.medico.username }}</td>
                    <td>{{ agendamento.aluno.username|default:"N/A" }}</td> {# Exibe o nome do aluno ou "N/A" se não houver #}
                    <td>{{ agendamento.data }}</td>
                    <td>{{ agendamento.get_status_display }}</td> {# Exibe o status do agendamento de forma amigável #}
                    <td>
                        {# Botão para editar o agendamento #}
                        <a href="{% url 'clinica:agendamento_update' agendamento.pk %}" class="btn btn-sm btn-secondary"><i class="fa-solid fa-pencil"></i> Editar</a>
                        {# Botão para excluir o agendamento, com ícone e confirmação via JavaScript #}
                        <a href="{% url 'clinica:agendamento_delete' agendamento.pk %}" class="btn btn-sm btn-danger"><i class="fa-solid fa-trash"></i> Excluir</a>
                    </td>
                </tr>
            {% empty %} {# Exibido se não houver agendamentos #}
                <tr>
                    <td colspan="6">Nenhum agendamento cadastrado.</td> {# Mensagem de tabela vazia #}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {# Navegação de Paginação #}
    <nav aria-label="Page navigation"> {# Componente de navegação para paginação #}
        <ul class="pagination justify-content-center"> {# Lista de itens de paginação centralizada #}
            {# Link para a página anterior #}
            {% if agendamentos.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ agendamentos.previous_page_number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={{ order_by }}">Anterior</a></li>
            {% else %}
                <li class="page-item disabled"><a class="page-link" href="#">Anterior</a></li> {# Desabilitado se não houver página anterior #}
            {% endif %}

            {# Links para cada página #}
            {% for i in agendamentos.paginator.page_range %}
                {% if agendamentos.number == i %}
                    <li class="page-item active"><a class="page-link" href="#">{{ i }}</a></li> {# Página atual destacada #}
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}&search={{ request.GET.search|default_if_none:'' }}&order_by={{ order_by }}">{{ i }}</a></li> {# Link para outras páginas #}
                {% endif %}
            {% endfor %}

            {# Link para a próxima página #}
            {% if agendamentos.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ agendamentos.next_page_number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={{ order_by }}">Próximo</a></li>
            {% else %}
                <li class="page-item disabled"><a class="page-link" href="#">Próximo</a></li> {# Desabilitado se não houver próxima página #}
            {% endif %}
        </ul>
    </nav>
{% endblock %} {# Fim do bloco de conteúdo #}
