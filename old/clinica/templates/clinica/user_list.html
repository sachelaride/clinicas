

{% extends 'clinica/base.html' %} {# Estende o template base para herdar a estrutura e estilos #}

{% block content %} {# Início do bloco de conteúdo principal da página #}
    {# Título da página #}
    <h2>Lista de Usuários</h2>

    {# Formulário de busca e botões de ação #}
    <form method="get" class="mb-3 d-flex gap-2 align-items-center"> {# Formulário GET para busca, com layout flexível #}
        {# Campo de input para o termo de busca #}
        <input type="text" name="search" class="form-control" placeholder="Buscar por username, RGM ou perfil" value="{{ request.GET.search|default_if_none:'' }}"> {# O valor é preenchido com o termo de busca atual, se houver #}
        {# Botão para submeter a busca #}
        <button type="submit" class="btn btn-primary"><i class="fa-solid fa-magnifying-glass"></i> Buscar</button>
        {# Botão para limpar os filtros de busca e ordenação #}
        <a href="{% url 'clinica:user_list' %}" class="btn btn-info"><i class="fa-solid fa-arrows-rotate"></i> Limpar</a>
    </form>

    {# Botão para criar um novo usuário #}
    <a href="{% url 'clinica:user_create' %}" class="btn btn-success mb-3"><i class="fa-solid fa-plus"></i> Novo Usuário</a>

    {# Tabela para exibir a lista de usuários #}
    <table class="table table-striped"> {# Tabela com linhas zebradas para melhor legibilidade #}
        <thead> {# Cabeçalho da tabela #}
            <tr>
                {# Colunas ordenáveis: ao clicar, a lista é reordenada por este campo #}
                <th><a href="?page={{ users.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'username' %}-username{% else %}username{% endif %}">Username {% if order_by == 'username' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-username' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th><a href="?page={{ users.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'rgm' %}-rgm{% else %}rgm{% endif %}">RGM {% if order_by == 'rgm' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-rgm' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th><a href="?page={{ users.number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={% if order_by == 'perfil' %}-perfil{% else %}perfil{% endif %}">Perfil {% if order_by == 'perfil' %}<i class="fa-solid fa-arrow-up"></i>{% elif order_by == '-perfil' %}<i class="fa-solid fa-arrow-down"></i>{% endif %}</a></th>
                <th>Clínica</th> {# Coluna não ordenável #}
                <th>Ações</th> {# Coluna para botões de ação #}
            </tr>
        </thead>
        <tbody> {# Corpo da tabela #}
            {% for user in users %} {# Itera sobre cada usuário na página atual #}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.rgm }}</td>
                    <td>{{ user.get_perfil_display }}</td> {# Exibe o nome amigável do perfil #}
                    <td>{{ user.clinica.nome|default:"N/A" }}</td> {# Exibe o nome da clínica ou "N/A" se não houver #}
                    <td>
                        {# Botão para editar o usuário #}
                        <a href="{% url 'clinica:user_update' user.pk %}" class="btn btn-sm btn-secondary"><i class="fa-solid fa-pencil"></i> Editar</a>
                        {# Botão para excluir o usuário, com ícone e confirmação via JavaScript #}
                        <a href="{% url 'clinica:user_delete' user.pk %}" class="btn btn-sm btn-danger"><i class="fa-solid fa-trash"></i> Excluir</a>
                    </td>
                </tr>
            {% empty %} {# Exibido se não houver usuários #}
                <tr>
                    <td colspan="5">Nenhum usuário cadastrado.</td> {# Mensagem de tabela vazia #}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {# Navegação de Paginação #}
    <nav aria-label="Page navigation"> {# Componente de navegação para paginação #}
        <ul class="pagination justify-content-center"> {# Lista de itens de paginação centralizada #}
            {# Link para a página anterior #}
            {% if users.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ users.previous_page_number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={{ order_by }}">Anterior</a></li>
            {% else %}
                <li class="page-item disabled"><a class="page-link" href="#">Anterior</a></li> {# Desabilitado se não houver página anterior #}
            {% endif %}

            {# Links para cada página #}
            {% for i in users.paginator.page_range %}
                {% if users.number == i %}
                    <li class="page-item active"><a class="page-link" href="#">{{ i }}</a></li> {# Página atual destacada #}
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}&search={{ request.GET.search|default_if_none:'' }}&order_by={{ order_by }}">{{ i }}</a></li> {# Link para outras páginas #}
                {% endif %}
            {% endfor %}

            {# Link para a próxima página #}
            {% if users.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ users.next_page_number }}&search={{ request.GET.search|default_if_none:'' }}&order_by={{ order_by }}">Próximo</a></li>
            {% else %}
                <li class="page-item disabled"><a class="page-link" href="#">Próximo</a></li> {# Desabilitado se não houver próxima página #}
            {% endif %}
        </ul>
    </nav>
{% endblock %} {# Fim do bloco de conteúdo #}
